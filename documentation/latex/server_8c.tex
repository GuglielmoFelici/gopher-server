\hypertarget{server_8c}{}\section{src/server.c File Reference}
\label{server_8c}\index{src/server.\+c@{src/server.\+c}}
{\ttfamily \#include \char`\"{}../headers/server.\+h\char`\"{}}\newline
{\ttfamily \#include $<$stdbool.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include \char`\"{}../headers/datatypes.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}../headers/log.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}../headers/logger.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}../headers/platform.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}../headers/protocol.\+h\char`\"{}}\newline
{\ttfamily \#include $<$pthread.\+h$>$}\newline
{\ttfamily \#include $<$sys/select.\+h$>$}\newline
{\ttfamily \#include $<$sys/types.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
Include dependency graph for server.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{server_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static bool \hyperlink{server_8c_a40764179ec01d128c2e283cc0c48f861}{check\+Signal} (int which)
\item 
static int \hyperlink{server_8c_ab5d26b6eaa18f325703884b09eaa7732}{serve\+Thread} (socket\+\_\+t sock, int port, \hyperlink{structlogger__t}{logger\+\_\+t} $\ast$p\+Logger)
\item 
static int \hyperlink{server_8c_a3482e754925b7ca4bd3a67706051b4c6}{serve\+Proc} (socket\+\_\+t client, const \hyperlink{structlogger__t}{logger\+\_\+t} $\ast$p\+Logger, const \hyperlink{structserver__t}{server\+\_\+t} $\ast$p\+Server)
\item 
int \hyperlink{server_8c_a4c40ae864a752c34a4f237a9445db202}{prepare\+Socket} (\hyperlink{structserver__t}{server\+\_\+t} $\ast$p\+Server, int flags)
\item 
void \hyperlink{server_8c_a2cda6ac8456a82040d05596906d66acc}{default\+Config} (\hyperlink{structserver__t}{server\+\_\+t} $\ast$p\+Server, int which)
\item 
int \hyperlink{server_8c_a2e07cc3959eab913ab4c894bc6c8395d}{read\+Config} (\hyperlink{structserver__t}{server\+\_\+t} $\ast$p\+Server, int which)
\item 
int \hyperlink{server_8c_a533c9a4292e9d1106ff7c54fbf75090a}{run\+Server} (\hyperlink{structserver__t}{server\+\_\+t} $\ast$p\+Server, \hyperlink{structlogger__t}{logger\+\_\+t} $\ast$p\+Logger)
\item 
int \hyperlink{server_8c_a6db637a291288a25af4d89d9f0f3ab31}{install\+Default\+Sig\+Handlers} ()
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{server_8c_a40764179ec01d128c2e283cc0c48f861}\label{server_8c_a40764179ec01d128c2e283cc0c48f861}} 
\index{server.\+c@{server.\+c}!check\+Signal@{check\+Signal}}
\index{check\+Signal@{check\+Signal}!server.\+c@{server.\+c}}
\subsubsection{\texorpdfstring{check\+Signal()}{checkSignal()}}
{\footnotesize\ttfamily static bool check\+Signal (\begin{DoxyParamCaption}\item[{int}]{which }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Atomically checks if a config update or a shutdown have been requested. 
\begin{DoxyParams}{Parameters}
{\em which} & Can be C\+H\+E\+C\+K\+\_\+\+C\+O\+N\+F\+IG or C\+H\+E\+C\+K\+\_\+\+S\+H\+U\+T\+D\+O\+WN, depending on the check to perform. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
true if the requested request have been 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_a2cda6ac8456a82040d05596906d66acc}\label{server_8c_a2cda6ac8456a82040d05596906d66acc}} 
\index{server.\+c@{server.\+c}!default\+Config@{default\+Config}}
\index{default\+Config@{default\+Config}!server.\+c@{server.\+c}}
\subsubsection{\texorpdfstring{default\+Config()}{defaultConfig()}}
{\footnotesize\ttfamily void default\+Config (\begin{DoxyParamCaption}\item[{\hyperlink{structserver__t}{server\+\_\+t} $\ast$}]{p\+Server,  }\item[{int}]{which }\end{DoxyParamCaption})}

Sets the default options. 
\begin{DoxyParams}{Parameters}
{\em p\+Server} & The \hyperlink{structserver__t}{server\+\_\+t} struct representing the server where the options will be stored. \\
\hline
{\em which} & A flag stating the option to default. Can be R\+E\+A\+D\+\_\+\+P\+O\+RT, R\+E\+A\+D\+\_\+\+M\+U\+L\+T\+I\+P\+R\+O\+C\+E\+SS or both or-\/ed. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{server_8c_a6db637a291288a25af4d89d9f0f3ab31}\label{server_8c_a6db637a291288a25af4d89d9f0f3ab31}} 
\index{server.\+c@{server.\+c}!install\+Default\+Sig\+Handlers@{install\+Default\+Sig\+Handlers}}
\index{install\+Default\+Sig\+Handlers@{install\+Default\+Sig\+Handlers}!server.\+c@{server.\+c}}
\subsubsection{\texorpdfstring{install\+Default\+Sig\+Handlers()}{installDefaultSigHandlers()}}
{\footnotesize\ttfamily int install\+Default\+Sig\+Handlers (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Installs the default signal handlers for the main process. On Windows, C\+T\+R\+L\+\_\+C interrupts the server and C\+T\+R\+L\+\_\+\+B\+R\+E\+AK requests a configuration update. On Linux, S\+I\+G\+I\+NT interrupts the server and S\+I\+G\+H\+UP requests a configuration update. \begin{DoxyReturn}{Returns}
S\+E\+R\+V\+E\+R\+\_\+\+S\+U\+C\+C\+E\+SS or S\+E\+R\+V\+E\+R\+\_\+\+F\+A\+I\+L\+U\+RE. 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_a4c40ae864a752c34a4f237a9445db202}\label{server_8c_a4c40ae864a752c34a4f237a9445db202}} 
\index{server.\+c@{server.\+c}!prepare\+Socket@{prepare\+Socket}}
\index{prepare\+Socket@{prepare\+Socket}!server.\+c@{server.\+c}}
\subsubsection{\texorpdfstring{prepare\+Socket()}{prepareSocket()}}
{\footnotesize\ttfamily int prepare\+Socket (\begin{DoxyParamCaption}\item[{\hyperlink{structserver__t}{server\+\_\+t} $\ast$}]{p\+Server,  }\item[{int}]{flags }\end{DoxyParamCaption})}

Initializes a server socket and sets it to listening. 
\begin{DoxyParams}{Parameters}
{\em p\+Server} & The \hyperlink{structserver__t}{server\+\_\+t} struct representing the server \\
\hline
{\em flags} & Can be S\+E\+R\+V\+E\+R\+\_\+\+U\+P\+D\+A\+TE if a change of port was requested, or S\+E\+R\+V\+E\+R\+\_\+\+I\+N\+IT if the socket must be initialized from scratch. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\+E\+R\+V\+E\+R\+\_\+\+S\+U\+C\+C\+E\+SS or S\+E\+R\+V\+E\+R\+\_\+\+F\+A\+I\+L\+U\+RE. 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_a2e07cc3959eab913ab4c894bc6c8395d}\label{server_8c_a2e07cc3959eab913ab4c894bc6c8395d}} 
\index{server.\+c@{server.\+c}!read\+Config@{read\+Config}}
\index{read\+Config@{read\+Config}!server.\+c@{server.\+c}}
\subsubsection{\texorpdfstring{read\+Config()}{readConfig()}}
{\footnotesize\ttfamily int read\+Config (\begin{DoxyParamCaption}\item[{\hyperlink{structserver__t}{server\+\_\+t} $\ast$}]{p\+Server,  }\item[{int}]{which }\end{DoxyParamCaption})}

Reads the options from a configuration file. 
\begin{DoxyParams}{Parameters}
{\em p\+Server} & The \hyperlink{structserver__t}{server\+\_\+t} struct representing the server where the options will be stored. \\
\hline
{\em which} & A flag stating the option to default. Can be R\+E\+A\+D\+\_\+\+P\+O\+RT, R\+E\+A\+D\+\_\+\+M\+U\+L\+T\+I\+P\+R\+O\+C\+E\+SS or both or-\/ed. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\+E\+R\+V\+E\+R\+\_\+\+S\+U\+C\+C\+E\+SS or S\+E\+R\+V\+E\+R\+\_\+\+F\+A\+I\+L\+U\+RE. 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_a533c9a4292e9d1106ff7c54fbf75090a}\label{server_8c_a533c9a4292e9d1106ff7c54fbf75090a}} 
\index{server.\+c@{server.\+c}!run\+Server@{run\+Server}}
\index{run\+Server@{run\+Server}!server.\+c@{server.\+c}}
\subsubsection{\texorpdfstring{run\+Server()}{runServer()}}
{\footnotesize\ttfamily int run\+Server (\begin{DoxyParamCaption}\item[{\hyperlink{structserver__t}{server\+\_\+t} $\ast$}]{p\+Server,  }\item[{\hyperlink{structlogger__t}{logger\+\_\+t} $\ast$}]{p\+Logger }\end{DoxyParamCaption})}

Starts a gopher server. 
\begin{DoxyParams}{Parameters}
{\em p\+Server} & A \hyperlink{structserver__t}{server\+\_\+t} struct representing the server to run. \\
\hline
{\em p\+Logger} & A \hyperlink{structlogger__t}{logger\+\_\+t} struct representing the transfer logging process (can be N\+U\+LL). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\+E\+R\+V\+E\+R\+\_\+\+S\+U\+C\+C\+E\+SS if the server is terminated by the user, S\+E\+R\+V\+E\+R\+\_\+\+F\+A\+I\+L\+U\+RE otherwise. 
\end{DoxyReturn}
\mbox{\Hypertarget{server_8c_a3482e754925b7ca4bd3a67706051b4c6}\label{server_8c_a3482e754925b7ca4bd3a67706051b4c6}} 
\index{server.\+c@{server.\+c}!serve\+Proc@{serve\+Proc}}
\index{serve\+Proc@{serve\+Proc}!server.\+c@{server.\+c}}
\subsubsection{\texorpdfstring{serve\+Proc()}{serveProc()}}
{\footnotesize\ttfamily static int serve\+Proc (\begin{DoxyParamCaption}\item[{socket\+\_\+t}]{client,  }\item[{const \hyperlink{structlogger__t}{logger\+\_\+t} $\ast$}]{p\+Logger,  }\item[{const \hyperlink{structserver__t}{server\+\_\+t} $\ast$}]{p\+Server }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Servest a request with a new process. \begin{DoxySeeAlso}{See also}
\hyperlink{server_8c_ab5d26b6eaa18f325703884b09eaa7732}{serve\+Thread()} 
\end{DoxySeeAlso}
\mbox{\Hypertarget{server_8c_ab5d26b6eaa18f325703884b09eaa7732}\label{server_8c_ab5d26b6eaa18f325703884b09eaa7732}} 
\index{server.\+c@{server.\+c}!serve\+Thread@{serve\+Thread}}
\index{serve\+Thread@{serve\+Thread}!server.\+c@{server.\+c}}
\subsubsection{\texorpdfstring{serve\+Thread()}{serveThread()}}
{\footnotesize\ttfamily static int serve\+Thread (\begin{DoxyParamCaption}\item[{socket\+\_\+t}]{sock,  }\item[{int}]{port,  }\item[{\hyperlink{structlogger__t}{logger\+\_\+t} $\ast$}]{p\+Logger }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Serves a request with a new thread. 
\begin{DoxyParams}{Parameters}
{\em sock} & The socket of the client. \\
\hline
{\em port} & The port where the server has been contacted. \\
\hline
{\em p\+Logger} & A pointer to the \hyperlink{structlogger__t}{logger\+\_\+t} struct representing the logging process (can be N\+U\+LL). \\
\hline
\end{DoxyParams}
